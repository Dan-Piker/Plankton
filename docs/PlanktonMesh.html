<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>PlanktonMesh.cs</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>

  <div id="jump_to">
    Jump To &hellip;
    <div id="jump_wrapper">
      <div id="jump_page">
          <a class="source" href="PlanktonFace.html">PlanktonFace.cs</a>
          <a class="source" href="PlanktonFaceList.html">PlanktonFaceList.cs</a>
          <a class="source" href="PlanktonHalfedge.html">PlanktonHalfedge.cs</a>
          <a class="source" href="PlanktonHalfedgeList.html">PlanktonHalfedgeList.cs</a>
          <a class="source" href="PlanktonMesh.html">PlanktonMesh.cs</a>
          <a class="source" href="PlanktonVertex.html">PlanktonVertex.cs</a>
          <a class="source" href="PlanktonVertexList.html">PlanktonVertexList.cs</a>
          <a class="source" href="PlanktonXYZ.html">PlanktonXYZ.cs</a>
          <a class="source" href="RhinoSupport.html">RhinoSupport.cs</a>
      </div>
    </div>
  </div>

  <div class='section'>
    <div class='docs'><h1>PlanktonMesh.cs</h1></div>
  </div>
  <div class='clearall'>
  <div class='section ' id=''>
    <div class='docs'>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Plankton</span>
<span class="p">{</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section public' id='plankton-mesh'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#plankton-mesh'>#</a>
      </div>
      <h2>PlanktonMesh</h2>
<p>This is the main class that describes a plankton mesh.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">public</span> <span class="k">class</span> <span class="nc">PlanktonMesh</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="n">PlanktonVertexList</span> <span class="n">_vertices</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">PlanktonHalfEdgeList</span> <span class="n">_halfedges</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">PlanktonFaceList</span> <span class="n">_faces</span><span class="p">;</span>
        
        <span class="cp">#region &quot;constructors&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section public' id='.ctor'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#.ctor'>#</a>
      </div>
      <h3>.ctor</h3>
<p>Initializes a new (empty) instance of the <a href="PlanktonMesh.html">PlanktonMesh</a> class.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">public</span> <span class="nf">PlanktonMesh</span><span class="p">()</span>
        <span class="p">{</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section public' id='.ctor-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#.ctor-1'>#</a>
      </div>
      <h3>.ctor</h3>
<p>Initializes a new (duplicate) instance of the <a href="PlanktonMesh.html">PlanktonMesh</a> class.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">public</span> <span class="nf">PlanktonMesh</span><span class="p">(</span><span class="n">PlanktonMesh</span> <span class="n">source</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">v</span> <span class="k">in</span> <span class="n">source</span><span class="p">.</span><span class="n">Vertices</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">PlanktonVertex</span><span class="p">()</span> <span class="p">{</span>
                                      <span class="n">OutgoingHalfedge</span> <span class="p">=</span> <span class="n">v</span><span class="p">.</span><span class="n">OutgoingHalfedge</span><span class="p">,</span>
                                      <span class="n">X</span> <span class="p">=</span> <span class="n">v</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
                                      <span class="n">Y</span> <span class="p">=</span> <span class="n">v</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span>
                                      <span class="n">Z</span> <span class="p">=</span> <span class="n">v</span><span class="p">.</span><span class="n">Z</span>
                                  <span class="p">});</span>
            <span class="p">}</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">f</span> <span class="k">in</span> <span class="n">source</span><span class="p">.</span><span class="n">Faces</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">PlanktonFace</span><span class="p">()</span> <span class="p">{</span> <span class="n">FirstHalfedge</span> <span class="p">=</span> <span class="n">f</span><span class="p">.</span><span class="n">FirstHalfedge</span> <span class="p">});</span>
            <span class="p">}</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">h</span> <span class="k">in</span> <span class="n">source</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">PlanktonHalfedge</span><span class="p">()</span> <span class="p">{</span>
                                       <span class="n">StartVertex</span> <span class="p">=</span> <span class="n">h</span><span class="p">.</span><span class="n">StartVertex</span><span class="p">,</span>
                                       <span class="n">AdjacentFace</span> <span class="p">=</span> <span class="n">h</span><span class="p">.</span><span class="n">AdjacentFace</span><span class="p">,</span>
                                       <span class="n">NextHalfedge</span> <span class="p">=</span> <span class="n">h</span><span class="p">.</span><span class="n">NextHalfedge</span><span class="p">,</span>
                                       <span class="n">PrevHalfedge</span> <span class="p">=</span> <span class="n">h</span><span class="p">.</span><span class="n">PrevHalfedge</span><span class="p">,</span>
                                   <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="cp">#endregion</span>

        <span class="cp">#region &quot;properties&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section public' id='vertices'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#vertices'>#</a>
      </div>
      <h3>Vertices</h3>
<p>Gets access to the <a href="PlanktonVertexList.html">PlanktonVertexList</a> collection in this mesh.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">public</span> <span class="n">PlanktonVertexList</span> <span class="n">Vertices</span>
        <span class="p">{</span>
            <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_vertices</span> <span class="p">??</span> <span class="p">(</span><span class="n">_vertices</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PlanktonVertexList</span><span class="p">(</span><span class="k">this</span><span class="p">));</span> <span class="p">}</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section public' id='halfedges'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#halfedges'>#</a>
      </div>
      <h3>Halfedges</h3>
<p>Gets access to the <a href="PlanktonHalfedgeList.html">PlanktonHalfedgeList</a> collection in this mesh.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">public</span> <span class="n">PlanktonHalfEdgeList</span> <span class="n">Halfedges</span>
        <span class="p">{</span>
            <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_halfedges</span> <span class="p">??</span> <span class="p">(</span><span class="n">_halfedges</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PlanktonHalfEdgeList</span><span class="p">(</span><span class="k">this</span><span class="p">));</span> <span class="p">}</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section public' id='faces'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#faces'>#</a>
      </div>
      <h3>Faces</h3>
<p>Gets access to the <a href="PlanktonFaceList.html">PlanktonFaceList</a> collection in this mesh.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">public</span> <span class="n">PlanktonFaceList</span> <span class="n">Faces</span>
        <span class="p">{</span>
            <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_faces</span> <span class="p">??</span> <span class="p">(</span><span class="n">_faces</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PlanktonFaceList</span><span class="p">(</span><span class="k">this</span><span class="p">));</span> <span class="p">}</span>
        <span class="p">}</span>
        <span class="cp">#endregion</span>

        <span class="cp">#region &quot;general methods&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section public' id='volume'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#volume'>#</a>
      </div>
      <h3>Volume</h3>
<p>Calculate the volume of the mesh</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">public</span> <span class="kt">double</span> <span class="nf">Volume</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">double</span> <span class="n">VolumeSum</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="kt">int</span><span class="p">[]</span> <span class="n">FaceVerts</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">GetFaceVertices</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                <span class="kt">int</span> <span class="n">EdgeCount</span> <span class="p">=</span> <span class="n">FaceVerts</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">EdgeCount</span> <span class="p">==</span> <span class="m">3</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">PlanktonXYZ</span> <span class="n">P</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">FaceVerts</span><span class="p">[</span><span class="m">0</span><span class="p">]].</span><span class="n">ToXYZ</span><span class="p">();</span>
                    <span class="n">PlanktonXYZ</span> <span class="n">Q</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">FaceVerts</span><span class="p">[</span><span class="m">1</span><span class="p">]].</span><span class="n">ToXYZ</span><span class="p">();</span>
                    <span class="n">PlanktonXYZ</span> <span class="n">R</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">FaceVerts</span><span class="p">[</span><span class="m">2</span><span class="p">]].</span><span class="n">ToXYZ</span><span class="p">();</span>
                    <span class="c1">//get the signed volume of the tetrahedron formed by the triangle and the origin</span>
                    <span class="n">VolumeSum</span> <span class="p">+=</span> <span class="p">(</span><span class="m">1</span> <span class="p">/</span> <span class="m">6d</span><span class="p">)</span> <span class="p">*</span> <span class="p">(</span>
                           <span class="n">P</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">Z</span> <span class="p">+</span>
                           <span class="n">P</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">X</span> <span class="p">+</span>
                           <span class="n">P</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span>
                           <span class="n">P</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span>
                           <span class="n">P</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">Z</span> <span class="p">-</span>
                           <span class="n">P</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">PlanktonXYZ</span> <span class="n">P</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_faces</span><span class="p">.</span><span class="n">GetFaceCenter</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">EdgeCount</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
                    <span class="p">{</span>
                        <span class="n">PlanktonXYZ</span> <span class="n">Q</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">FaceVerts</span><span class="p">[</span><span class="n">j</span><span class="p">]].</span><span class="n">ToXYZ</span><span class="p">();</span>
                        <span class="n">PlanktonXYZ</span> <span class="n">R</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">FaceVerts</span><span class="p">[(</span><span class="n">j</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span> <span class="p">%</span> <span class="n">EdgeCount</span><span class="p">]].</span><span class="n">ToXYZ</span><span class="p">();</span>
                        <span class="n">VolumeSum</span> <span class="p">+=</span> <span class="p">(</span><span class="m">1</span> <span class="p">/</span> <span class="m">6d</span><span class="p">)</span> <span class="p">*</span> <span class="p">(</span>
                            <span class="n">P</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">Z</span> <span class="p">+</span> 
                            <span class="n">P</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">X</span> <span class="p">+</span> 
                            <span class="n">P</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span> 
                            <span class="n">P</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span> 
                            <span class="n">P</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">Z</span> <span class="p">-</span> 
                            <span class="n">P</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>            
            <span class="k">return</span> <span class="n">VolumeSum</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">PlanktonMesh</span> <span class="nf">Dual</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// hack for open meshes</span>
            <span class="c1">// TODO: improve this ugly method</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">IsClosed</span><span class="p">()</span> <span class="p">==</span> <span class="k">false</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">dual</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PlanktonMesh</span><span class="p">();</span>

                <span class="c1">// create vertices from face centers</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
                <span class="p">{</span>
                    <span class="n">dual</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">GetFaceCenter</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
                <span class="p">}</span>

                <span class="c1">// create faces from the adjacent face indices of non-boundary vertices</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">IsBoundary</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="p">{</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="n">dual</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">AddFace</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">GetVertexFaces</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
                <span class="p">}</span>

                <span class="k">return</span> <span class="n">dual</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// can later add options for other ways of defining face centres (barycenter/circumcenter etc)</span>
            <span class="c1">// won&#39;t work yet with naked boundaries</span>

            <span class="n">PlanktonMesh</span> <span class="n">P</span> <span class="p">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="n">PlanktonMesh</span> <span class="n">D</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PlanktonMesh</span><span class="p">();</span>

            <span class="c1">//for every primal face, add the barycenter to the dual&#39;s vertex list</span>
            <span class="c1">//dual vertex outgoing HE is primal face&#39;s start HE</span>
            <span class="c1">//for every vertex of the primal, add a face to the dual</span>
            <span class="c1">//dual face&#39;s startHE is primal vertex&#39;s outgoing&#39;s pair</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">P</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">fc</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">GetFaceCenter</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                <span class="n">D</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">PlanktonVertex</span><span class="p">(</span><span class="n">fc</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">fc</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">fc</span><span class="p">.</span><span class="n">Z</span><span class="p">));</span>
                <span class="kt">int</span><span class="p">[]</span> <span class="n">FaceHalfedges</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">GetHalfedges</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">FaceHalfedges</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">[</span><span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">GetPairHalfedge</span><span class="p">(</span><span class="n">FaceHalfedges</span><span class="p">[</span><span class="n">j</span><span class="p">])].</span><span class="n">AdjacentFace</span> <span class="p">!=</span> <span class="p">-</span><span class="m">1</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="c1">// D.Vertices[i].OutgoingHalfedge = FaceHalfedges[j];</span>
                        <span class="n">D</span><span class="p">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">D</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">-</span><span class="m">1</span><span class="p">].</span><span class="n">OutgoingHalfedge</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">GetPairHalfedge</span><span class="p">(</span><span class="n">FaceHalfedges</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">P</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">NakedEdgeCount</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="kt">int</span> <span class="n">df</span> <span class="p">=</span> <span class="n">D</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">PlanktonFace</span><span class="p">.</span><span class="n">Unset</span><span class="p">);</span>
                    <span class="c1">// D.Faces[i].FirstHalfedge = P.PairHalfedge(P.Vertices[i].OutgoingHalfedge);</span>
                    <span class="n">D</span><span class="p">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">df</span><span class="p">].</span><span class="n">FirstHalfedge</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">OutgoingHalfedge</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// dual halfedge start V is primal AdjacentFace</span>
            <span class="c1">// dual halfedge AdjacentFace is primal end V</span>
            <span class="c1">// dual nextHE is primal&#39;s pair&#39;s prev</span>
            <span class="c1">// dual prevHE is primal&#39;s next&#39;s pair</span>

            <span class="c1">// halfedge pairs stay the same</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">AdjacentFace</span> <span class="p">!=</span> <span class="p">-</span><span class="m">1</span><span class="p">)</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">[</span><span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">GetPairHalfedge</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">AdjacentFace</span> <span class="p">!=</span> <span class="p">-</span><span class="m">1</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">PlanktonHalfedge</span> <span class="n">DualHE</span> <span class="p">=</span> <span class="n">PlanktonHalfedge</span><span class="p">.</span><span class="n">Unset</span><span class="p">;</span>
                    <span class="n">PlanktonHalfedge</span> <span class="n">PrimalHE</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                    <span class="c1">//DualHE.StartVertex = PrimalHE.AdjacentFace;</span>
                    <span class="n">DualHE</span><span class="p">.</span><span class="n">StartVertex</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">[</span><span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">GetPairHalfedge</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">AdjacentFace</span><span class="p">;</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">NakedEdgeCount</span><span class="p">(</span><span class="n">PrimalHE</span><span class="p">.</span><span class="n">StartVertex</span><span class="p">)</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="c1">//DualHE.AdjacentFace = P.Halfedges[P.PairHalfedge(i)].StartVertex;</span>
                        <span class="n">DualHE</span><span class="p">.</span><span class="n">AdjacentFace</span> <span class="p">=</span> <span class="n">PrimalHE</span><span class="p">.</span><span class="n">StartVertex</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="p">{</span> <span class="n">DualHE</span><span class="p">.</span><span class="n">AdjacentFace</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span> <span class="p">}</span>
                    
                    <span class="c1">//This will currently fail with open meshes...</span>
                    <span class="c1">//one option could be to build the dual with all halfedges, but mark some as dead</span>
                    <span class="c1">//if they connect to vertex -1</span>
                    <span class="c1">//mark the &#39;external&#39; faces all as -1 (the ones that are dual to boundary verts)</span>
                    <span class="c1">//then go through and if any next or prevs are dead hes then replace them with the next one around</span>
                    <span class="c1">//this needs to be done repeatedly until no further change</span>

                    <span class="c1">//DualHE.NextHalfedge = P.Halfedges[P.PairHalfedge(i)].PrevHalfedge;</span>
                    <span class="n">DualHE</span><span class="p">.</span><span class="n">NextHalfedge</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">GetPairHalfedge</span><span class="p">(</span><span class="n">PrimalHE</span><span class="p">.</span><span class="n">PrevHalfedge</span><span class="p">);</span>

                    <span class="c1">//DualHE.PrevHalfedge = P.PairHalfedge(PrimalHE.NextHalfedge);</span>
                    <span class="n">DualHE</span><span class="p">.</span><span class="n">PrevHalfedge</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">[</span><span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">GetPairHalfedge</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">NextHalfedge</span><span class="p">;</span>

                    <span class="n">D</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">DualHE</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">D</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="kt">bool</span> <span class="nf">IsClosed</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">AdjacentFace</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section public' id='truncate-vertices'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#truncate-vertices'>#</a>
      </div>
      <h3>TruncateVertices</h3>
<p>Truncates the vertices of a mesh.</p>
<h4>Parameters</h4>
<ul>
<li><em>t</em>: Optional parameter for the normalised distance along each edge to control the amount of truncation.</li>
</ul>
<h4>Returns</h4>
<p>A new mesh, the result of the truncation.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">public</span> <span class="n">PlanktonMesh</span> <span class="nf">TruncateVertices</span><span class="p">(</span><span class="kt">float</span> <span class="n">t</span> <span class="p">=</span> <span class="m">1f</span><span class="p">/</span><span class="m">3</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// TODO: handle special cases (t = 0.0, t = 0.5, t &gt; 0.5)</span>
            <span class="kt">var</span> <span class="n">tMesh</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PlanktonMesh</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">vxyz</span> <span class="p">=</span> <span class="n">tMesh</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">v</span> <span class="p">=&gt;</span> <span class="n">v</span><span class="p">.</span><span class="n">ToXYZ</span><span class="p">()).</span><span class="n">ToArray</span><span class="p">();</span>
            <span class="n">PlanktonXYZ</span> <span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">;</span>
            <span class="kt">int</span><span class="p">[]</span> <span class="n">oh</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="n">oh</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">GetHalfedges</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                <span class="n">tMesh</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">TruncateVertex</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">h</span> <span class="k">in</span> <span class="n">oh</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">v0</span> <span class="p">=</span> <span class="n">vxyz</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">[</span><span class="n">h</span><span class="p">].</span><span class="n">StartVertex</span><span class="p">];</span>
                    <span class="n">v1</span> <span class="p">=</span> <span class="n">vxyz</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">EndVertex</span><span class="p">(</span><span class="n">h</span><span class="p">)];</span>
                    <span class="n">v2</span> <span class="p">=</span> <span class="n">v0</span> <span class="p">+</span> <span class="p">(</span><span class="n">v1</span> <span class="p">-</span> <span class="n">v0</span><span class="p">)</span> <span class="p">*</span> <span class="n">t</span><span class="p">;</span>
                    <span class="n">tMesh</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">SetVertex</span><span class="p">(</span><span class="n">tMesh</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">[</span><span class="n">h</span><span class="p">].</span><span class="n">StartVertex</span><span class="p">,</span> <span class="n">v2</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">v2</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">v2</span><span class="p">.</span><span class="n">Z</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">tMesh</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="cm">/* Hide for the time being to avoid confusion...</span>
<span class="cm">        public void RefreshVertexNormals()</span>
<span class="cm">        {</span>
<span class="cm">        }</span>
<span class="cm">        public void RefreshFaceNormals()</span>
<span class="cm">        {</span>
<span class="cm">        }</span>
<span class="cm">        public void RefreshEdgeNormals()</span>
<span class="cm">        {</span>
<span class="cm">        }</span>
<span class="cm">        */</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section public' id='compact'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#compact'>#</a>
      </div>
      <h3>Compact</h3>
<p>Removes any unreferenced objects from arrays, reindexes as needed and shrinks arrays to minimum required size.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">public</span> <span class="k">void</span> <span class="nf">Compact</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// Compact vertices, faces and halfedges</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">CompactHelper</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">CompactHelper</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">CompactHelper</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">//dihedral angle for an edge</span>
        <span class="c1">//</span>

        <span class="c1">//skeletonize - build a new mesh with 4 faces for each original edge</span>

        <span class="cp">#endregion</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
