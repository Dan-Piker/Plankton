<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>PlanktonMesh.cs</title>
  <link rel="stylesheet" href="../../pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  
  <div id="jump_to">
    Jump To &hellip;
    <div id="jump_wrapper">
      <div id="jump_page">
          <a class="source" href="/Users/Will/Code/GitHub/Plankton/docs/src/Plankton/PlanktonFace.html">src/Plankton/PlanktonFace.cs</a>
          <a class="source" href="/Users/Will/Code/GitHub/Plankton/docs/src/Plankton/PlanktonFaceList.html">src/Plankton/PlanktonFaceList.cs</a>
          <a class="source" href="/Users/Will/Code/GitHub/Plankton/docs/src/Plankton/PlanktonHalfedge.html">src/Plankton/PlanktonHalfedge.cs</a>
          <a class="source" href="/Users/Will/Code/GitHub/Plankton/docs/src/Plankton/PlanktonHalfedgeList.html">src/Plankton/PlanktonHalfedgeList.cs</a>
          <a class="source" href="/Users/Will/Code/GitHub/Plankton/docs/src/Plankton/PlanktonMesh.html">src/Plankton/PlanktonMesh.cs</a>
          <a class="source" href="/Users/Will/Code/GitHub/Plankton/docs/src/Plankton/PlanktonVertex.html">src/Plankton/PlanktonVertex.cs</a>
          <a class="source" href="/Users/Will/Code/GitHub/Plankton/docs/src/Plankton/PlanktonVertexList.html">src/Plankton/PlanktonVertexList.cs</a>
          <a class="source" href="/Users/Will/Code/GitHub/Plankton/docs/src/Plankton/PlanktonXYZ.html">src/Plankton/PlanktonXYZ.cs</a>
      </div>
    </div>
  </div>
  
  <div class='section'>
    <div class='docs'><h1>PlanktonMesh.cs</h1></div>
  </div>
  <div class='clearall'>
  <div class='section public' id='section-00-planktonmesh'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-00-planktonmesh'>#</a>
      </div>
      <h2>PlanktonMesh</h2>
<p>Description of PlanktonMesh.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">ï</span><span class="err">»¿</span><span class="c1">//using Rhino.Geometry;</span>
<span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">Plankton</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">PlanktonMesh</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="n">PlanktonVertexList</span> <span class="n">_vertices</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">PlanktonHalfEdgeList</span> <span class="n">_halfedges</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">PlanktonFaceList</span> <span class="n">_faces</span><span class="p">;</span>
        
        <span class="cp">#region &quot;constructors&quot;</span>
        <span class="k">public</span> <span class="nf">PlanktonMesh</span><span class="p">()</span> <span class="c1">//blank constructor</span>
        <span class="p">{</span>
        <span class="p">}</span>
        
        <span class="k">public</span> <span class="nf">PlanktonMesh</span><span class="p">(</span><span class="n">PlanktonMesh</span> <span class="n">source</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">v</span> <span class="k">in</span> <span class="n">source</span><span class="p">.</span><span class="n">Vertices</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">PlanktonVertex</span><span class="p">()</span> <span class="p">{</span>
                                      <span class="n">OutgoingHalfedge</span> <span class="p">=</span> <span class="n">v</span><span class="p">.</span><span class="n">OutgoingHalfedge</span><span class="p">,</span>
                                      <span class="n">X</span> <span class="p">=</span> <span class="n">v</span><span class="p">.</span><span class="n">X</span><span class="p">,</span>
                                      <span class="n">Y</span> <span class="p">=</span> <span class="n">v</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span>
                                      <span class="n">Z</span> <span class="p">=</span> <span class="n">v</span><span class="p">.</span><span class="n">Z</span>
                                  <span class="p">});</span>
            <span class="p">}</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">f</span> <span class="k">in</span> <span class="n">source</span><span class="p">.</span><span class="n">Faces</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">PlanktonFace</span><span class="p">()</span> <span class="p">{</span> <span class="n">FirstHalfedge</span> <span class="p">=</span> <span class="n">f</span><span class="p">.</span><span class="n">FirstHalfedge</span> <span class="p">});</span>
            <span class="p">}</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">h</span> <span class="k">in</span> <span class="n">source</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">PlanktonHalfedge</span><span class="p">()</span> <span class="p">{</span>
                                       <span class="n">StartVertex</span> <span class="p">=</span> <span class="n">h</span><span class="p">.</span><span class="n">StartVertex</span><span class="p">,</span>
                                       <span class="n">AdjacentFace</span> <span class="p">=</span> <span class="n">h</span><span class="p">.</span><span class="n">AdjacentFace</span><span class="p">,</span>
                                       <span class="n">NextHalfedge</span> <span class="p">=</span> <span class="n">h</span><span class="p">.</span><span class="n">NextHalfedge</span><span class="p">,</span>
                                       <span class="n">PrevHalfedge</span> <span class="p">=</span> <span class="n">h</span><span class="p">.</span><span class="n">PrevHalfedge</span><span class="p">,</span>
                                   <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="cp">#endregion</span>

        <span class="cp">#region &quot;properties&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section public' id='section-01-vertices'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-01-vertices'>#</a>
      </div>
      <h2>Vertices</h2>
<p>Gets access to the vertices collection in this mesh.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">public</span> <span class="n">PlanktonVertexList</span> <span class="n">Vertices</span>
        <span class="p">{</span>
            <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_vertices</span> <span class="p">??</span> <span class="p">(</span><span class="n">_vertices</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PlanktonVertexList</span><span class="p">(</span><span class="k">this</span><span class="p">));</span> <span class="p">}</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section public' id='section-02-halfedges'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-02-halfedges'>#</a>
      </div>
      <h2>Halfedges</h2>
<p>Gets access to the halfedges collection in this mesh.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">public</span> <span class="n">PlanktonHalfEdgeList</span> <span class="n">Halfedges</span>
        <span class="p">{</span>
            <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_halfedges</span> <span class="p">??</span> <span class="p">(</span><span class="n">_halfedges</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PlanktonHalfEdgeList</span><span class="p">(</span><span class="k">this</span><span class="p">));</span> <span class="p">}</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section public' id='section-03-faces'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-03-faces'>#</a>
      </div>
      <h2>Faces</h2>
<p>Gets access to the faces collection in this mesh.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">public</span> <span class="n">PlanktonFaceList</span> <span class="n">Faces</span>
        <span class="p">{</span>
            <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_faces</span> <span class="p">??</span> <span class="p">(</span><span class="n">_faces</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PlanktonFaceList</span><span class="p">(</span><span class="k">this</span><span class="p">));</span> <span class="p">}</span>
        <span class="p">}</span>
        <span class="cp">#endregion</span>

        <span class="cp">#region &quot;general methods&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section public' id='section-04-volume'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-04-volume'>#</a>
      </div>
      <h2>Volume</h2>
<p>Calculate the volume of the mesh</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">public</span> <span class="kt">double</span> <span class="nf">Volume</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">double</span> <span class="n">VolumeSum</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="kt">int</span><span class="p">[]</span> <span class="n">FaceVerts</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">GetFaceVertices</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                <span class="kt">int</span> <span class="n">EdgeCount</span> <span class="p">=</span> <span class="n">FaceVerts</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">EdgeCount</span> <span class="p">==</span> <span class="m">3</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">PlanktonXYZ</span> <span class="n">P</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">FaceVerts</span><span class="p">[</span><span class="m">0</span><span class="p">]].</span><span class="n">ToXYZ</span><span class="p">();</span>
                    <span class="n">PlanktonXYZ</span> <span class="n">Q</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">FaceVerts</span><span class="p">[</span><span class="m">1</span><span class="p">]].</span><span class="n">ToXYZ</span><span class="p">();</span>
                    <span class="n">PlanktonXYZ</span> <span class="n">R</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">FaceVerts</span><span class="p">[</span><span class="m">2</span><span class="p">]].</span><span class="n">ToXYZ</span><span class="p">();</span>
                    <span class="c1">//get the signed volume of the tetrahedron formed by the triangle and the origin</span>
                    <span class="n">VolumeSum</span> <span class="p">+=</span> <span class="p">(</span><span class="m">1</span> <span class="p">/</span> <span class="m">6d</span><span class="p">)</span> <span class="p">*</span> <span class="p">(</span>
                           <span class="n">P</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">Z</span> <span class="p">+</span>
                           <span class="n">P</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">X</span> <span class="p">+</span>
                           <span class="n">P</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span>
                           <span class="n">P</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span>
                           <span class="n">P</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">Z</span> <span class="p">-</span>
                           <span class="n">P</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">PlanktonXYZ</span> <span class="n">P</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">_faces</span><span class="p">.</span><span class="n">GetFaceCenter</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">EdgeCount</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
                    <span class="p">{</span>
                        <span class="n">PlanktonXYZ</span> <span class="n">Q</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">FaceVerts</span><span class="p">[</span><span class="n">j</span><span class="p">]].</span><span class="n">ToXYZ</span><span class="p">();</span>
                        <span class="n">PlanktonXYZ</span> <span class="n">R</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">FaceVerts</span><span class="p">[(</span><span class="n">j</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span> <span class="p">%</span> <span class="n">EdgeCount</span><span class="p">]].</span><span class="n">ToXYZ</span><span class="p">();</span>
                        <span class="n">VolumeSum</span> <span class="p">+=</span> <span class="p">(</span><span class="m">1</span> <span class="p">/</span> <span class="m">6d</span><span class="p">)</span> <span class="p">*</span> <span class="p">(</span>
                            <span class="n">P</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">Z</span> <span class="p">+</span> 
                            <span class="n">P</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">X</span> <span class="p">+</span> 
                            <span class="n">P</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span> 
                            <span class="n">P</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">Y</span> <span class="p">-</span> 
                            <span class="n">P</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">X</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">Z</span> <span class="p">-</span> 
                            <span class="n">P</span><span class="p">.</span><span class="n">Z</span> <span class="p">*</span> <span class="n">Q</span><span class="p">.</span><span class="n">Y</span> <span class="p">*</span> <span class="n">R</span><span class="p">.</span><span class="n">X</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>            
            <span class="k">return</span> <span class="n">VolumeSum</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">PlanktonMesh</span> <span class="nf">Dual</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// can later add options for other ways of defining face centres (barycenter/circumcenter etc)</span>
            <span class="c1">// won&#39;t work yet with naked boundaries</span>

            <span class="n">PlanktonMesh</span> <span class="n">P</span> <span class="p">=</span> <span class="k">this</span><span class="p">;</span>
            <span class="n">PlanktonMesh</span> <span class="n">D</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PlanktonMesh</span><span class="p">();</span>

            <span class="c1">//for every primal face, add the barycenter to the dual&#39;s vertex list</span>
            <span class="c1">//dual vertex outgoing HE is primal face&#39;s start HE</span>
            <span class="c1">//for every vertex of the primal, add a face to the dual</span>
            <span class="c1">//dual face&#39;s startHE is primal vertex&#39;s outgoing&#39;s pair</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">P</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="kt">var</span> <span class="n">fc</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">GetFaceCenter</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                <span class="n">D</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span> <span class="n">PlanktonVertex</span><span class="p">(</span><span class="n">fc</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">fc</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">fc</span><span class="p">.</span><span class="n">Z</span><span class="p">));</span>
                <span class="kt">int</span><span class="p">[]</span> <span class="n">FaceHalfedges</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">GetHalfedges</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">j</span> <span class="p">&lt;</span> <span class="n">FaceHalfedges</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">j</span><span class="p">++)</span>
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">[</span><span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">GetPairHalfedge</span><span class="p">(</span><span class="n">FaceHalfedges</span><span class="p">[</span><span class="n">j</span><span class="p">])].</span><span class="n">AdjacentFace</span> <span class="p">!=</span> <span class="p">-</span><span class="m">1</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="c1">// D.Vertices[i].OutgoingHalfedge = FaceHalfedges[j];</span>
                        <span class="n">D</span><span class="p">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">D</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">-</span><span class="m">1</span><span class="p">].</span><span class="n">OutgoingHalfedge</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">GetPairHalfedge</span><span class="p">(</span><span class="n">FaceHalfedges</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">P</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">NakedEdgeCount</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="kt">int</span> <span class="n">df</span> <span class="p">=</span> <span class="n">D</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">PlanktonFace</span><span class="p">.</span><span class="n">Unset</span><span class="p">);</span>
                    <span class="c1">// D.Faces[i].FirstHalfedge = P.PairHalfedge(P.Vertices[i].OutgoingHalfedge);</span>
                    <span class="n">D</span><span class="p">.</span><span class="n">Faces</span><span class="p">[</span><span class="n">df</span><span class="p">].</span><span class="n">FirstHalfedge</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">Vertices</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">OutgoingHalfedge</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// dual halfedge start V is primal AdjacentFace</span>
            <span class="c1">// dual halfedge AdjacentFace is primal end V</span>
            <span class="c1">// dual nextHE is primal&#39;s pair&#39;s prev</span>
            <span class="c1">// dual prevHE is primal&#39;s next&#39;s pair</span>

            <span class="c1">// halfedge pairs stay the same</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">AdjacentFace</span> <span class="p">!=</span> <span class="p">-</span><span class="m">1</span><span class="p">)</span> <span class="p">&amp;</span> <span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">[</span><span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">GetPairHalfedge</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">AdjacentFace</span> <span class="p">!=</span> <span class="p">-</span><span class="m">1</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="n">PlanktonHalfedge</span> <span class="n">DualHE</span> <span class="p">=</span> <span class="n">PlanktonHalfedge</span><span class="p">.</span><span class="n">Unset</span><span class="p">;</span>
                    <span class="n">PlanktonHalfedge</span> <span class="n">PrimalHE</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                    <span class="c1">//DualHE.StartVertex = PrimalHE.AdjacentFace;</span>
                    <span class="n">DualHE</span><span class="p">.</span><span class="n">StartVertex</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">[</span><span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">GetPairHalfedge</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">AdjacentFace</span><span class="p">;</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">P</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">NakedEdgeCount</span><span class="p">(</span><span class="n">PrimalHE</span><span class="p">.</span><span class="n">StartVertex</span><span class="p">)</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="c1">//DualHE.AdjacentFace = P.Halfedges[P.PairHalfedge(i)].StartVertex;</span>
                        <span class="n">DualHE</span><span class="p">.</span><span class="n">AdjacentFace</span> <span class="p">=</span> <span class="n">PrimalHE</span><span class="p">.</span><span class="n">StartVertex</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="p">{</span> <span class="n">DualHE</span><span class="p">.</span><span class="n">AdjacentFace</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span> <span class="p">}</span>
                    
                    <span class="c1">//This will currently fail with open meshes...</span>
                    <span class="c1">//one option could be to build the dual with all halfedges, but mark some as dead</span>
                    <span class="c1">//if they connect to vertex -1</span>
                    <span class="c1">//mark the &#39;external&#39; faces all as -1 (the ones that are dual to boundary verts)</span>
                    <span class="c1">//then go through and if any next or prevs are dead hes then replace them with the next one around</span>
                    <span class="c1">//this needs to be done repeatedly until no further change</span>

                    <span class="c1">//DualHE.NextHalfedge = P.Halfedges[P.PairHalfedge(i)].PrevHalfedge;</span>
                    <span class="n">DualHE</span><span class="p">.</span><span class="n">NextHalfedge</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">GetPairHalfedge</span><span class="p">(</span><span class="n">PrimalHE</span><span class="p">.</span><span class="n">PrevHalfedge</span><span class="p">);</span>

                    <span class="c1">//DualHE.PrevHalfedge = P.PairHalfedge(PrimalHE.NextHalfedge);</span>
                    <span class="n">DualHE</span><span class="p">.</span><span class="n">PrevHalfedge</span> <span class="p">=</span> <span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">[</span><span class="n">P</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">GetPairHalfedge</span><span class="p">(</span><span class="n">i</span><span class="p">)].</span><span class="n">NextHalfedge</span><span class="p">;</span>

                    <span class="n">D</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">DualHE</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">D</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">RefreshVertexNormals</span><span class="p">()</span>
        <span class="p">{</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">RefreshFaceNormals</span><span class="p">()</span>
        <span class="p">{</span>
        <span class="p">}</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">RefreshEdgeNormals</span><span class="p">()</span>
        <span class="p">{</span>
        <span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section public' id='section-05-compact'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-05-compact'>#</a>
      </div>
      <h2>Compact</h2>
<p>Removes any unreferenced objects from arrays, reindexes as needed and shrinks arrays to minimum required size.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">public</span> <span class="k">void</span> <span class="nf">Compact</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="c1">// Compact vertices, faces and halfedges</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Vertices</span><span class="p">.</span><span class="n">CompactHelper</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Faces</span><span class="p">.</span><span class="n">CompactHelper</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Halfedges</span><span class="p">.</span><span class="n">CompactHelper</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">//dihedral angle for an edge</span>
        <span class="c1">//</span>

        <span class="c1">//skeletonize - build a new mesh with 4 faces for each original edge</span>

        <span class="cp">#endregion</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
